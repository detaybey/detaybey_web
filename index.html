<!DOCTYPE html>
<html>
<head>
    <title>.:'</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        html, body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(#000044, #002299);
            font-family: "Fira Mono", monospace;
        }

        canvas {
            background: #000;
            display: block;
            margin: 0 auto;
            border: solid 2px #000;
            border-radius: 10px;
        }
        #author {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: #ffcc00;
            padding: 4px 10px 3px 10px;
            border-radius: 3px;            
            font-weight: 100;
            font-style: normal;
            font-size: 10px;
            font-weight: 400;
            border: solid 1px #000;
        }
        #game {
            display: flex;
            flex-direction: column;
        }
        .score {
            width: 140px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            font-weight: 100;
            color:#fff;
        }
        #scores {
            display: flex;
            flex-direction: row;
            padding: 1px;
            margin: 0;
            padding: 10px;
            width: 400px;
        }
    </style>
</head>
<body>
    <div id="game">
        <div id="scores">
            <div id="score0" class="score">.</div>
            <div id="score1" class="score">.</div>
        </div>
        <canvas id="breakerCanvas" width="400" height="400"></canvas>
    </div>
    <div id="water"></div>
    <div id="author">detaybey</div>
    <script>
        const canvas = document.getElementById('breakerCanvas');
        const ctx = canvas.getContext('2d');
        var scores = [10,11];
        const PADDLE_WIDTH = 100;
        const PADDLE_HEIGHT = 20;
        const BALL_SIZE = 10;
        const BRICK_ROWS = 16;
        const BRICK_COLS = 16;
        const BRICK_WIDTH = Math.round(canvas.width / BRICK_COLS);
        const BRICK_HEIGHT = Math.round(canvas.height / BRICK_ROWS);
        const WHITE = '#FFFFFF';
        const BLACK = '#000000';
        const BRICK_MAP = [
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
            1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
        ]

        const ox1 = (canvas.width / 2) - (canvas.width / 4) - Math.random()*15;
        const ox2 = (canvas.width / 2) + (canvas.width / 4) + Math.random()*15;
        const oy1 = (canvas.height / 2) - Math.random()*15;
        const oy2 = (canvas.height / 2) + Math.random()*15;
        
        const ballSpeed = 5;
        
        let balls = [
            { x: ox1, y: oy1, dx: ballSpeed, dy: -1*ballSpeed, color: BLACK, history: [] },
            { x: ox2, y: oy2, dx: -1*ballSpeed, dy: ballSpeed, color: WHITE, history: [] }
        ];
        
        function isStuck(ball) {
            if (ball.history.length < 5) return false;

            // Check for oscillating pattern
            for (let i = 1; i < ball.history.length; i++) {
                if (ball.history[i].dx !== -ball.history[i-1].dx ||
                    ball.history[i].dy !== -ball.history[i-1].dy) {
                    return false;
                }
            }

            console.log('stuck!');
            return true;
        }

        // Move balls and check for collisions
        function moveBalls() {
            balls.forEach(ball => {
                ball.x += ball.dx;
                ball.y += ball.dy;

                if (ball.x < BALL_SIZE || ball.x + BALL_SIZE > canvas.width) {
                    ball.dx = -ball.dx;
                    ball.x += ball.dx * 3 + Math.random() * 2
                }

                if (ball.y < BALL_SIZE || ball.y + BALL_SIZE > canvas.height) {
                    ball.dy = -ball.dy;
                    ball.y += ball.dy * 3 + Math.random() * 2
                }

                for (let y = 0; y < BRICK_ROWS; y++) {
                    for (let x = 0; x < BRICK_COLS; x++) {
                        const brickColor = BRICK_MAP[x + (y*BRICK_COLS)] == 1 ? WHITE: BLACK;
                        if (ball.color != brickColor) { continue;}

                        const brickX = x * BRICK_WIDTH;
                        const brickY = y * BRICK_HEIGHT;
                        if (ball.x + BALL_SIZE >= brickX && ball.x - BALL_SIZE <= brickX + BRICK_WIDTH &&
                            ball.y + BALL_SIZE >= brickY && ball.y - BALL_SIZE <= brickY + BRICK_HEIGHT) {
                            const hitFromLeftOrRight = (ball.x + BALL_SIZE <= brickX + BRICK_WIDTH/2) || (ball.x - BALL_SIZE >= brickX + BRICK_WIDTH/2);
                            const hitFromTopOrBottom = (ball.y + BALL_SIZE <= brickY + BRICK_HEIGHT/2) || (ball.y - BALL_SIZE >= brickY + BRICK_HEIGHT/2);
                            if (hitFromLeftOrRight) { ball.dx = -ball.dx; }
                            if (hitFromTopOrBottom) { ball.dy = -ball.dy; }
                            BRICK_MAP[x + (y*BRICK_COLS)] = brickColor == WHITE ? 0 : 1;
                        }
                    }
                }

                checkBallCollision();
                getScore();
            });
        }

        function checkBallCollision() {
            let dx = balls[1].x - balls[0].x;
            let dy = balls[1].y - balls[0].y;
            let distance = Math.sqrt(dx * dx + dy * dy);

            // Check if the balls are colliding
            if (distance < BALL_SIZE * 2) {
                // Calculate collision response directions
                let nx = dx / distance;
                let ny = dy / distance;

                // Increase the separation distance
                let separationDistance = BALL_SIZE * 3;

                // Separate the balls more aggressively to prevent sticking
                balls[0].x -= nx * separationDistance;
                balls[0].y -= ny * separationDistance;
                balls[1].x += nx * separationDistance;
                balls[1].y += ny * separationDistance;

                // Invert the velocities
                balls[0].dx = -balls[0].dx;
                balls[0].dy = -balls[0].dy;
                balls[1].dx = -balls[1].dx;
                balls[1].dy = -balls[1].dy;
            }
        }

        function getScore() {

            scores[1]= BRICK_MAP.filter(x=> x==0).length;
            scores[0]= BRICK_MAP.filter(x=> x==1).length;

            const score0 = scores[0] * 400 / 256;
            const score1 = scores[1] * 400 / 256;

            document.getElementById('score0').innerText = scores[0];
            document.getElementById('score0').style.color = BLACK;
            document.getElementById('score0').style.backgroundColor = WHITE;
            document.getElementById('score0').style.width = score0 + 'px';

            document.getElementById('score1').style.color = WHITE;
            document.getElementById('score1').style.backgroundColor = BLACK;
            document.getElementById('score1').innerText = scores[1];
            document.getElementById('score1').style.width = score1 + 'px';
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let y = 0; y < BRICK_ROWS; y++) {
                for (let x = 0; x < BRICK_COLS; x++) {
                    ctx.fillStyle = BRICK_MAP[x + (y*BRICK_COLS)] == 1 ? WHITE: BLACK;
                    ctx.fillRect(x*BRICK_WIDTH, y * BRICK_HEIGHT, BRICK_WIDTH, BRICK_HEIGHT);
                }
            }
            balls.forEach(ball => {
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, BALL_SIZE, 0, Math.PI*2);
                ctx.fillStyle = ball.color;
                ctx.fill();
                ctx.closePath();
            });
            moveBalls();
        }

        function gameLoop() {
            draw();
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
